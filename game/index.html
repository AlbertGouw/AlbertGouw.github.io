<canvas id="ctx" width="500" height="500" style="border:1px solid #000000;"></canvas>
<script src="js/Entities.js"></script>
<script> 
var ctx = document.getElementById("ctx").getContext("2d"); 
ctx.font = '30px Arial';

var HEIGHT = 500;
var WIDTH = 500;
var timeWhenGameStarted = Date.now();	//return time in ms

var frameCount = 0;

var score = 0;

var Img = {};
Img.player = new Image();
Img.player.src = "img/player1.png";
Img.enemy = new Image();
Img.enemy.src = 'img/rocks.png';
Img.bullet = new Image();
Img.bullet.src = 'img/bullet.png';
Img.upgrade1 = new Image();
Img.upgrade1.src = 'img/heart.png';
Img.upgrade2 = new Image();
Img.upgrade2.src = 'img/upgrade2.png';
Img.map = new Image();
Img.map.src = 'img/background.png';


testCollisionRectRect = function(rect1,rect2){
	return rect1.x <= rect2.x+rect2.width 
		&& rect2.x <= rect1.x+rect1.width
		&& rect1.y <= rect2.y + rect2.height
		&& rect2.y <= rect1.y + rect1.height;
}


document.onkeydown = function(event){
	if(event.keyCode === 68)	//d
		player.pressingRight = true;
	else if(event.keyCode === 83)	//s
		player.pressingDown = true;
	else if(event.keyCode === 65) //a
		player.pressingLeft = true;
	else if(event.keyCode === 87) // w
		player.pressingUp = true;
}

document.onkeyup = function(event){
	if(event.keyCode === 68)	//d
		player.pressingRight = false;
	else if(event.keyCode === 83)	//s
		player.pressingDown = false;
	else if(event.keyCode === 65) //a
		player.pressingLeft = false;
	else if(event.keyCode === 87) // w
		player.pressingUp = false;
}

update = function(){
	ctx.clearRect(0,0,WIDTH,HEIGHT);
	drawMap();
	frameCount++;
	score++;
	
	if(frameCount % 100 === 0)	//every 4 sec
		randomlyGenerateEnemy();

	if(frameCount % 75 === 0)	//every 3 sec
		randomlyGenerateUpgrade();
	
	
	for(var key in upgradeList){
		upgradeList[key].update();
		var isColliding = player.testCollision(upgradeList[key]);
		if(isColliding){
			if(upgradeList[key].category === 'health')
				{
					player.hp += 25;
				}
			if (upgradeList[key].category === 'traps')
				{
					player.hp -= 100;
				}
			    
			delete upgradeList[key];
		}
	}
	
	for(var key in enemyList){
		enemyList[key].update();
		var isColliding = player.testCollision(enemyList[key]);
		if(isColliding){
			player.hp = player.hp - 1;
		}
	}
	if(player.hp <= 0){
		var timeSurvived = Date.now() - timeWhenGameStarted;		
		console.log("You lost! You survived for " + timeSurvived + " ms.");	
		
		startNewGame();
		alert("Your score is " + timeSurvived + " \n please refresh browser to continue");	
	}
	player.update();
    ctx.fillStyle = 'red';
	ctx.fillText(player.hp , 0,38);
	ctx.drawImage(Img.upgrade1, 55 , 0)
	ctx.fillText('Score: ' + score,200,38);
}

startNewGame = function(){
	
	player.hp = 1000;
	timeWhenGameStarted = Date.now();
	frameCount = 0;
	score = 0;
	enemyList = {};
	upgradeList = {};
	randomlyGenerateEnemy();
	randomlyGenerateEnemy();
	randomlyGenerateEnemy();
	
}

player = Player();

var gameSpeed = prompt("Please enter the level of the game you want from \"Easy\" , \"Medium\" , \"Hard\", \"Super Hard\" ");
var framepersec;
if(gameSpeed === "Easy")
{
   framepersec = 30;
}
else if(gameSpeed === "Medium")
{
   framepersec = 20;
}

else if(gameSpeed === "Hard")
{
	framepersec = 10;
}
else if(gameSpeed === "Super Hard")
{
	framepersec = 5;
}
startNewGame();



setInterval(update, framepersec);

drawMap = function ()
{ ctx.drawImage(Img.map,0,0)}










</script>
